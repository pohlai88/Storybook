/* 40-utilities.css */
@layer utilities {
  /* ========================================================================
     1. ACCESSIBILITY & INTERACTION HELPERS
     Critical for compliance and usability in data-dense interfaces.
     ======================================================================== */

  /* Screen Reader Only (Standard Accessibly Hidden) */
  .sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip-path: inset(50%);
    white-space: nowrap;
    border: 0;
  }

  /* Focus Ring Helper (Programmatic Focus)
     Usage: .na-focus-ring or :focus-visible
     WCAG 2.2 AAA compliant with system token visibility.
  */
  .na-focus-ring:focus-visible {
    outline: var(--outline-width) solid var(--color-gold);
    outline-offset: var(--outline-offset);
  }

  /* Click Target Expansion (The "Fat Finger" Fix)
     Usage: Add to small buttons/icons to expand their hit area 
     to 44px (touch standard) without affecting visual layout.
     Requires parent to have 'position: relative'.
  */
  .na-clickable {
    position: relative;
  }
  .na-clickable::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    min-width: 44px;
    min-height: 44px;
    width: 100%;
    height: 100%;
  }

  /* Selection Controls (Enterprise Data UX) */
  .na-select-all {
    user-select: all; /* One-click selection for API Keys, IDs, Hashes */
    cursor: text;
  }
  .na-select-none {
    user-select: none; /* UI chrome, icons, draggable items */
  }

  /* ========================================================================
     2. TYPOGRAPHY UTILITIES
     Drift prevention wrappers for token-based type hierarchy.
     ======================================================================== */

  /* Semantic Heading Classes (Enforces Token Usage) */
  .na-h1 {
    font-size: var(--heading-1-size);
    font-weight: var(--heading-1-weight);
    line-height: var(--heading-1-line-height);
    color: var(--heading-1-color);
    letter-spacing: var(--heading-1-tracking);
  }

  .na-h2 {
    font-size: var(--heading-2-size);
    font-weight: var(--heading-2-weight);
    line-height: var(--heading-2-line-height);
    color: var(--heading-2-color);
    letter-spacing: var(--heading-2-tracking);
  }

  .na-h3 {
    font-size: var(--heading-3-size);
    font-weight: var(--heading-3-weight);
    line-height: var(--heading-3-line-height);
    color: var(--heading-3-color);
    letter-spacing: var(--heading-3-tracking);
  }

  .na-h4 {
    font-size: var(--heading-4-size);
    font-weight: var(--heading-4-weight);
    line-height: var(--heading-4-line-height);
    color: var(--heading-4-color);
    letter-spacing: var(--heading-4-tracking);
  }

  .na-h5 {
    font-size: var(--heading-5-size);
    font-weight: var(--heading-5-weight);
    line-height: var(--heading-5-line-height);
    color: var(--heading-5-color);
    letter-spacing: var(--heading-5-tracking);
  }

  .na-h6 {
    font-size: var(--heading-6-size);
    font-weight: var(--heading-6-weight);
    line-height: var(--heading-6-line-height);
    color: var(--heading-6-color);
    letter-spacing: var(--heading-6-tracking);
  }

  /* Smart Text Wrapping (Modern Browser Features)
     Prevents typographic widows and optimizes line breaking.
  */
  .na-balance {
    text-wrap: balance; /* Prevents typographic widows in titles (3+ lines) */
  }
  .na-pretty {
    text-wrap: pretty; /* Optimized line breaking for body text */
  }

  /* Data & Metadata Helpers */
  .na-data {
    font-size: var(--data-size);
    font-weight: var(--data-weight);
    color: var(--data-color);
    font-family: var(--data-font);
    font-variant-numeric: tabular-nums; /* Critical for financial data alignment */
  }

  .na-data-large {
    font-size: var(--data-large-size);
    font-weight: var(--data-large-weight);
    color: var(--data-large-color);
    font-family: var(--data-large-font);
  }

  .na-metadata {
    font-size: var(--metadata-size);
    font-weight: var(--metadata-weight);
    color: var(--metadata-color);
    letter-spacing: var(--metadata-tracking);
    text-transform: uppercase;
  }
  
  .na-metadata-small {
    font-size: var(--metadata-small-size);
    font-weight: var(--metadata-small-weight);
    color: var(--metadata-small-color);
  }
  
  /* Body Text Utilities (Common sizes used in components) */
  .na-body {
    font-size: var(--font-size-base); /* 16px */
    font-weight: var(--font-weight-normal);
    color: var(--color-lux);
    line-height: 1.6;
  }
  
  .na-body-sm {
    font-size: var(--font-size-sm); /* 14px */
    font-weight: var(--font-weight-normal);
    color: var(--color-lux);
    line-height: 1.5;
  }
  
  .na-label {
    font-size: var(--metadata-size); /* 11px */
    font-weight: var(--font-weight-semibold);
    color: var(--metadata-color);
    letter-spacing: var(--metadata-tracking);
    text-transform: uppercase;
  }

  /* Form Field Wrapper (Standard spacing between label and input) */
  .na-field {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-2); /* 8px - Standard gap between label and input */
    margin-bottom: var(--spacing-5); /* 20px - Standard spacing between fields */
  }

  /* Utility to force tabular numbers (for tables/KPIs) */
  .na-tabular {
    font-variant-numeric: tabular-nums;
  }

  /* Utility for muted text based on system tokens */
  .na-muted {
    color: color-mix(in srgb, var(--color-lux) 65%, var(--color-clay));
  }

  /* ========================================================================
     3. ROBUST TEXT TRUNCATION
     Essential for data grids and card titles.
     ======================================================================== */

  /* Single Line (Ellipsis)
     Usage: Apply to titles, labels, or single-line text that may overflow.
  */
  .na-truncate {
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }

  /* Multi-Line Clamping
     Usage: Apply to descriptions, card content, or multi-line text.
     Note: Uses -webkit-box for maximum browser compatibility.
     Standard line-clamp added for modern browser support.
  */
  .na-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .na-clamp-3 {
    display: -webkit-box;
    -webkit-line-clamp: 3;
    line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  /* ========================================================================
     4. LAYOUT, LAYERING & VISUALS
     ======================================================================== */

  /* Semantic Z-Index Mappings (Matches 10-tokens.css)
     Prevents "z-fighting" bugs and makes layering intent clear.
     Usage: Apply to elements that need specific stacking context.
  */
  .na-z-base {
    z-index: var(--z-base);
  }
  .na-z-sticky {
    z-index: var(--z-sticky);
  }
  .na-z-drawer {
    z-index: var(--z-drawer);
  }
  .na-z-overlay {
    z-index: var(--z-overlay);
  }
  .na-z-modal {
    z-index: var(--z-modal);
  }
  .na-z-toast {
    z-index: var(--z-toast);
  }

  /* Standard Divider */
  .na-divider {
    border-top: 1px solid var(--color-stroke);
  }

  /* Shimmer Loading State
     Tokenized stops allow theme flexibility (light/dark variants)
     Animation fully tokenized for centralized control
  */
  .na-shimmer {
    background: linear-gradient(
      90deg,
      var(--shimmer-stop-weak),
      var(--shimmer-stop-strong),
      var(--shimmer-stop-weak)
    );
    background-size: 200% 100%;
    animation: var(--animate-shimmer);
  }

  /* Stagger Delays (for entering lists/grids)
     Uses tokenized delays for Figma-compliant timing
  */
  .stagger-0 { animation-delay: var(--delay-0); }
  .stagger-1 { animation-delay: var(--delay-50); }
  .stagger-2 { animation-delay: var(--delay-100); }
  .stagger-3 { animation-delay: var(--delay-150); }
  .stagger-4 { animation-delay: var(--delay-200); }

  /* Pulse Rings (Color-coded pulse animations)
     Usage: Add class to element (e.g., .na-pulse-success)
     Note: These set --pulse-color automatically for convenience
  */
  .na-pulse-success {
    --pulse-color: var(--color-success);
    animation: pulse-ring 2s var(--ease-smooth) infinite;
  }
  .na-pulse-warning {
    --pulse-color: var(--color-warning);
    animation: pulse-ring 2s var(--ease-smooth) infinite;
  }
  .na-pulse-error {
    --pulse-color: var(--color-error);
    animation: pulse-ring 2s var(--ease-smooth) infinite;
  }
  .na-pulse-info {
    --pulse-color: var(--color-info);
    animation: pulse-ring 2s var(--ease-smooth) infinite;
  }
  .na-pulse-gold {
    --pulse-color: var(--color-gold);
    animation: pulse-ring 2s var(--ease-smooth) infinite;
  }

  /* ========================================================================
     5. SCROLLBAR STYLING
     Theme-aware scrollbars for internal containers.
     ======================================================================== */
  .na-scroll {
    /* Firefox */
    scrollbar-width: thin;
    scrollbar-color: var(--scrollbar-thumb-hover) var(--scrollbar-track);
  }

  /* Webkit / Chrome / Edge */
  .na-scroll::-webkit-scrollbar {
    width: 10px;
    height: 10px;
  }

  .na-scroll::-webkit-scrollbar-thumb {
    background: var(--scrollbar-thumb);
    border-radius: 999px;
    border: 2px solid transparent; /* Creates padding effect */
    background-clip: padding-box;
  }
  .na-scroll::-webkit-scrollbar-thumb:hover {
    background: var(--scrollbar-thumb-hover);
  }

  .na-scroll::-webkit-scrollbar-track {
    background: var(--scrollbar-track);
  }

  /* ========================================================================
     6. DENSITY OVERRIDES
     Context-aware spacing adjustments.
     ======================================================================== */
  
  /* Compact Mode: Tighter spacing for data-heavy views */
  .na-density-compact p {
    line-height: 1.4; /* Tighter than base 1.6 */
  }

  /* Comfort Mode: Relaxed reading measure */
  .na-density-comfort p {
    line-height: 1.6; 
  }
}